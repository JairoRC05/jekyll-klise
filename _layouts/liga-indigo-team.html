---
layout: ligaIndigo
permalink:
---


<style>
    /* Estilos b√°sicos para la comparaci√≥n */
    .comparacion-calendarios h2 {
        text-align: center;
        margin: 1.5rem 0;
    }

    .comparacion-grid {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .comparacion-fila {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        padding: 0.75rem 0;
        border-bottom: 1px solid #eee;
    }

    .comparacion-rival {
        flex: 0 0 160px;
        font-weight: bold;
        align-self: center;
    }

    .comparacion-celda {
        flex: 1;
        min-width: 0;
    }

    .comparacion-celda.vacia {
        display: flex;
        align-items: center;
        justify-content: center;
        color: #999;
        font-size: 1.2em;
    }

    .mini .bracket-round-list {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .mini .bracket-round-team img {
        height: 36px;
        width: auto;
    }

    #selectedLogo img {
        height: 24px;
        width: auto;
        vertical-align: middle;
    }


    .dropdown-item {
        img {
            width: 20px;
        }

    }
</style>

<div id="equipo-perfil" class="">


</div>

<div class="games-section" id="equipo-perfil-partidos">

</div>


<div class="dropdown" id="rivalDropdown">
    <button class="dropdown-btn" id="dropdownBtn">
        <span id="selectedLogo"></span>
        <span id="selectedName">Selecciona un equipo</span>
        <i class="bi bi-chevron-down"></i>
    </button>

    <div class="dropdown-list" id="dropdownList"></div>

    <!-- Input oculto para obtener el TAG real -->
    <input type="hidden" id="selectedTag" value="">
</div>

<div id="comparisonContainer"></div>


{% include perfil-web.html %}

<div class="d-none justify-content-center align-items-center">
    <button id="descargarTodo" class="btn btn-primary mt-3">Descargar Calendario</button>
</div>


<div clas id="equipo-perfil-roster" class="games-section">
    <div class="container">


    </div>
</div>


{% include uniteforzestadium.html %}






<div id="equipo-perfil-footer" style="display: none;">
    <img src="/assets/backgrounds/uniteforzestadium.png" alt="">
</div>





<div id="stars1"></div>
<div id="stars2"></div>
<div id="stars3"></div>


{% include paypal.html %}






<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const pageID = "{{ page.ID }}";

        const jsonRosterURL = `/assets/temporadas/actual/rosters/${pageID.toLowerCase()}.json`;
        const jsonBannerURL = `/assets/temporadas/actual/${pageID.toLowerCase()}.json`;

        const descargarTodoBtn = document.getElementById('descargarTodo');
        const equipoPerfil = document.getElementById('equipo-perfil');
        const equipoPartidos = document.getElementById('equipo-perfil-partidos');
        const equipoFooterHTML = `<div id="temp-footer-descarga"><img src="/assets/backgrounds/uniteforzestadium.png" alt=""></div>`;

        const equipoSlugs = {
            "ENIGMA ESPORTS": "enigma-esports",
            "THE UNOWN TEAM": "the-unown-team",
            "DFS RUBY": "dragonflies-gaming-ruby",
            "DFS FROSTBITE": "dragonflies-gaming-frostbite",
            "DFS PLATINUM": "dragonflies-gaming-platino",
            "CAPIBYAS": "capibayas",
            "DINASTY": "dinasty",
            "GANBAR√ö DEX": "ganbaru-dex",
            "NEW FORCE": "new-force",
            "HAKKESSHU": "hakkesshu",
            "SLEEPKNOT": "sleepknot",
            "DORADITTOS": "doradittos",
        };

        const roundSpecificData = [
            { ronda: 'RONDA 1', fecha_inicio: '2025-07-10', fecha_fin: '2025-07-14', nombreImagen: 'scizor' },
            { ronda: 'RONDA 2', fecha_inicio: '2025-07-15', fecha_fin: '2025-07-16', nombreImagen: 'raichu' },
            { ronda: 'RONDA 3', fecha_inicio: '2025-07-17', fecha_fin: '2025-07-18', nombreImagen: 'goodra' },
            { ronda: 'RONDA 4', fecha_inicio: '2025-07-21', fecha_fin: '2025-07-22', nombreImagen: 'mimikyu' },
            { ronda: 'RONDA 5', fecha_inicio: '2025-07-23', fecha_fin: '2025-07-24', nombreImagen: 'urshifu' },
            { ronda: 'RONDA 6', fecha: '2025-07-25', nombreImagen: 'gengar' },
            { ronda: 'RONDA 7', fecha: '2025-07-28', nombreImagen: 'lapras' },
            { ronda: 'RONDA 8', fecha: '2025-07-29', nombreImagen: 'psyduck' },
            { ronda: 'RONDA 9', fecha: '2025-07-30', nombreImagen: 'cleafable' },
            { ronda: 'RONDA 10', fecha_inicio: '2025-07-31', fecha_fin: '2025-08-01', nombreImagen: 'espeonEstrella' },
            { ronda: 'RONDA 11', fecha: '2025-08-04', nombreImagen: 'gyarados' },
            { ronda: 'RONDA 12', fecha: '2025-08-04', nombreImagen: 'gyarados' },
            { ronda: 'RONDA 13', fecha: '2025-08-04', nombreImagen: 'gyarados' },
        ];


        if (descargarTodoBtn && equipoPerfil && equipoPartidos) {
            descargarTodoBtn.addEventListener('click', function () {
                const bannerHTML = equipoPerfil.outerHTML;
                const partidosHTML = equipoPartidos.outerHTML;
                const tempDescargaDiv = document.createElement('div');
                tempDescargaDiv.style.position = 'absolute';
                tempDescargaDiv.style.top = '-9999px';
                tempDescargaDiv.innerHTML = bannerHTML + partidosHTML + equipoFooterHTML;
                document.body.appendChild(tempDescargaDiv);
                html2canvas(tempDescargaDiv).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `perfil-completo-${pageID.toLowerCase()}.png`;
                    link.href = canvas.toDataURL();
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    document.body.removeChild(tempDescargaDiv);
                });
            });
        }





        function calcularSumaPartidos(partidos) {
            let suma = 0;
            for (const key in partidos) {
                const valor = partidos[key];
                if (valor !== "" && !isNaN(parseInt(valor))) {
                    suma += parseInt(valor);
                }
            }
            return suma;
        }

        function renderBanner(equipo, containerId) {
            let partidosBannerHTML = '<div class="card-round-title"><div class="card-round-record">';
            for (const partidoKey in equipo.partidos) {
                const resultado = equipo.partidos[partidoKey];
                let classRecord = '';
                let textoResultado = '';

                if (resultado === "3") {
                    classRecord = 'sup';
                    textoResultado = '3';
                } else if (resultado === "2") {
                    classRecord = 'win';
                    textoResultado = '2';
                } else if (resultado === "1") {
                    classRecord = 'one';
                    textoResultado = '1';
                } else if (resultado === "R") {
                    classRecord = 'rea';
                    textoResultado = 'R';
                } else if (resultado === "D") {
                    classRecord = 'des';
                    textoResultado = 'D';
                } else if (resultado === "0") {
                    classRecord = 'loss';
                    textoResultado = '0';
                }

                partidosBannerHTML += `<span class="record ${classRecord}">${textoResultado}</span>`;
            }
            partidosBannerHTML += '</div></div>';

            const bannerHTML = `
            <div class="profile indigo">
                <div class="profile-team">
                    <a href="/assets/logos/${equipo.tag}.png" role="button" download="${equipo.team.replace(/ /g, '-')}.png">
                        <img src="/assets/logos/${equipo.tag}.webp" class="drop" alt="${equipo.team}">
                    </a>
                    <div class="bannerText">
                        {% assign ligas_num = page.ligas | plus: 0 %}
                        {% assign cxf_num = page.cxf | plus: 0 %}
                        {% assign cham_num = page.cham | plus: 0 %}
                        {% assign verified_bool = page.verified %}
                    <div class="record-line">  
                     {% if ligas_num >= 1 %}
                    <div class="trofeos">
                      <img src="/assets/smalls/LI-TROFEO.webp" alt="LIGA INDIGO TROFEO">
                      <span>x{{ ligas_num }}</span>
                     </div>
                     {% endif %}
                     {% if cxf_num >= 1 %}
                      <div class="trofeos ms-2">
                       <img src="/assets/smalls/CXF.webp" alt="COPA CXF TROFEO">
                       <span>x{{ cxf_num }}</span>
                      </div>
                    {% endif %}
                    {% if cham_num >= 1 %}
                     <div class="trofeos ms-2">
                      <img src="/assets/smalls/CHAM.webp" alt="CHAMPIONS TROFEO">
                      <span>x{{ cham_num }}</span>
                     </div>
                    {% endif %}
                    {% if verified_bool %}
                     <div class="trofeos ms-2">
                      <img src="/assets/smalls/verified.webp" alt="CHAMPIONS TROFEO">
                     </div>
                    {% endif %}
                </div>
                      
                        <div class="region">
                        <div class="localization">
                          <h1 class="exo-style ">${equipo.team}</h1>
                         <span class="exo">${equipo.tag} ‚óè ${calcularSumaPartidos(equipo.partidos)} PTS</span>
                         <img class="ms-2" src="https://flagcdn.com/h20/{{page.pais}}.webp" alt="REGION: {{page.pais}}">
                         <span class="ms-2"> ${equipo.region}</span>
                        </div>
                            ${partidosBannerHTML}
                        </div>
                      
                    </div>
                      
                </div>
             
            </div>
        `;
            document.getElementById(containerId).innerHTML = bannerHTML;
        }


        function renderRoster(equipo, containerId) {
            let rosterHTML = '<h2 class="text-black">Roster del equipo</h2><div class="row">';
            equipo.jugadores.forEach(jugador => {
                rosterHTML += `
                <div class="col-md-6 col-lg-3 col-xl-2">
                    <div class="card-roster">
                        <div class="card-round-team">
                            <a href="#"> <img src="/assets/avatars/${jugador.avatar}.webp" alt="${jugador.nickname}" class="img-fluid">
                            </a>
                        </div>
                        <div class="card-round-title">
                            <h2>${truncateString(jugador.nickname, 15)}</h2>
                            <span>${jugador.ID}</span>
                        </div>
                        <div class="card-back">
                            <div class="card-color-left ${pageID === '7Z' ? 'S7Z' : pageID}"></div>
                            <div class="card-color-right bg-cham"></div>
                            <div class="card-color-logo">
                                <img src="/assets/logos/LIGA-INDIGO.webp" alt="LIGA INDIGO">
                            </div>
                        </div>
                    </div>
                </div>
            `;
            });
            rosterHTML += '</div>';
            const rosterContainer = document.querySelector(`#${containerId} `);
            if (rosterContainer) {
                rosterContainer.innerHTML = rosterHTML;
            } else {
                console.error(`No se encontr√≥ el contenedor con la clase 'container' dentro de #${containerId}`);
                document.getElementById(containerId).innerHTML = rosterHTML; // Fallback si no se encuentra el container
            }
        }

        /**
         * Formatea una cadena de fecha YYYY-MM-DD a DD MES (ej. 28 MAY).
         * Si la fecha incluye un rango (ej. YYYY-MM-DD - YYYY-MM-DD), formatea el rango.
         * @param {string} dateString La cadena de fecha a formatear.
         * @returns {string} La fecha formateada.
         */
        function formatDateToDayMonth(dateString) {
            const months = ['ENE', 'FEB', 'MAR', 'ABR', 'MAY', 'JUN', 'JUL', 'AGO', 'SEP', 'OCT', 'NOV', 'DIC'];

            if (dateString.includes(' - ')) {
                const [startDateStr, endDateStr] = dateString.split(' - ');
                const startDate = new Date(startDateStr + 'T00:00:00'); // A√±adir T00:00:00 para evitar problemas de zona horaria
                const endDate = new Date(endDateStr + 'T00:00:00');

                const startDay = startDate.getDate();
                const startMonth = months[startDate.getMonth()];
                const endDay = endDate.getDate();
                const endMonth = months[endDate.getMonth()];

                if (startDate.getMonth() === endDate.getMonth()) {
                    return `${startDay}-${endDay} ${startMonth}`;
                } else {
                    return `${startDay} ${startMonth} - ${endDay} ${endMonth}`;
                }
            } else if (dateString === 'Fecha no definida') {
                return 'Fecha no definida';
            } else {
                const date = new Date(dateString + 'T00:00:00'); // A√±adir T00:00:00 para evitar problemas de zona horaria
                const day = date.getDate();
                const month = months[date.getMonth()];
                return `${day} ${month}`;
            }
        }

        function renderMatchInfo(equipo, containerId, roundsDatesFromScript) {
            const teamTag = equipo.tag;
            let partidosHTML = '<div class=""><h2>CALENDARIO</h2><div class="row">';

            // Mapa de fechas por ronda desde roundSpecificData
            const roundDatesMap = new Map();
            roundsDatesFromScript.forEach(r => {
                const fechaStr = r.fecha || (r.fecha_inicio && r.fecha_fin ? `${r.fecha_inicio} - ${r.fecha_fin}` : 'Fecha no definida');
                roundDatesMap.set(r.ronda, fechaStr);
            });

            fetch('/assets/temporadas/actual/calendario.json')
                .then(r => r.json())
                .then(data => {
                    if (!data || !Array.isArray(data) || data.length === 0 || !data[0].rondas) {
                        throw new Error('Estructura de calendario.json inv√°lida');
                    }

                    const rondas = data[0].rondas;

                    // Paso 1: Recopilar todos los partidos del equipo
                    const partidosEquipo = [];

                    rondas.forEach(ronda => {
                        ronda.partidos.forEach(partido => {
                            if (partido.tag1 === teamTag || partido.tag2 === teamTag) {
                                partidosEquipo.push({
                                    ...partido,
                                    rondaNombre: ronda.ronda
                                });
                            }
                        });
                    });

                    // Paso 2: Ordenar por el orden definido en roundSpecificData
                    const orderedMatches = [];
                    roundsDatesFromScript.forEach(roundDef => {
                        const matchesOfRound = partidosEquipo.filter(p => p.rondaNombre === roundDef.ronda);
                        orderedMatches.push(...matchesOfRound);
                    });

                    // Paso 3: Renderizar en orden
                    if (orderedMatches.length > 0) {
                        orderedMatches.forEach(partidoOriginal => {
                            const partido = { ...partidoOriginal };
                            const originalRondaFecha = roundDatesMap.get(partido.rondaNombre) || 'Fecha no definida';
                            const formattedRondaFecha = formatDateToDayMonth(originalRondaFecha);

                            // üîÑ INVERTIR SI ES RONDA PAR
                            const numeroRonda = parseInt(partido.rondaNombre.replace('RONDA ', ''));
                            const invertir = !isNaN(numeroRonda) && numeroRonda % 2 === 0 && partido.equipo2 !== "DES";

                            if (invertir) {
                                [partido.equipo1, partido.equipo2] = [partido.equipo2, partido.equipo1];
                                [partido.tag1, partido.tag2] = [partido.tag2, partido.tag1];

                                if (partido.resultado && partido.resultado.includes('-')) {
                                    const [r1, r2] = partido.resultado.split('-');
                                    partido.resultado = `${r2}-${r1}`;
                                }
                            }

                            const equipo1T = truncateString(partido.equipo1, 12);
                            const equipo2T = truncateString(partido.equipo2, 12);

                            // ... dentro del bucle orderedMatches.forEach ...

                            const slugEquipo1 = equipoSlugs[partido.equipo1] || partido.equipo1.toLowerCase().replace(/\s+/g, '-');
                            const slugEquipo2 = equipoSlugs[partido.equipo2] || partido.equipo2.toLowerCase().replace(/\s+/g, '-');

                            partidosHTML += `
    <div class="col-12 col-md-6 col-lg-6 col-xl-4">
        ${partido.equipo2 === "DES" ? `
            <div class="bracket-round-list-zzz">
                <div class="card-round-promo">
                    <h3>DESCANSO</h3>
                </div>
                <div class="bracket-round-team">
                    <a href="/liga-indigo/equipos/${slugEquipo1}">
                        <img src="/assets/logos/${partido.equipo1}.webp" alt="${partido.equipo1}" class="img-fluid">
                    </a>
                </div>
                <div class="card-round-promo-left">
                    <span>${partido.rondaNombre}</span>
                </div>
                <div class="card-round-promo-right">
                    <span>${formattedRondaFecha}</span>
                </div>
                <div class="card-back">
                    <div class="card-color-left ${partido.equipo1 === '7Z' ? 'S7Z' : partido.equipo1}"></div>
                    <div class="card-color-right bg-cham"></div>
                </div>
            </div>
        ` : `
            <div class="bracket-round-list">
                <div class="bracket-round-team">
                    <a href="/liga-indigo/equipos/${slugEquipo1}">
                        <img src="/assets/logos/${partido.tag1}.webp" alt="${partido.equipo1}" class="img-fluid">
                    </a>
                </div>
                <div class="round-titles">
                    <div class="card-round-promo left">
                        <h6>${equipo1T}</h6>
                    </div>
                    <div class="card-round-promo mx-2">
                        ${partido.stream ? `
                            ${partido.resultado !== "VS" ? `
                                <span>${partido.rondaNombre}</span>
                                <h6>${partido.resultado}</h6>
                                <span>${partido.dia}</span>
                            ` : `
                                <span>${partido.rondaNombre}</span>
                                <span>TWITCH</span>
                                <span>${partido.dia}</span>
                                <span>${partido.hora}</span>
                            `}
                        ` : `
                            <span>${partido.rondaNombre}</span>
                            ${partido.resultado !== "VS" ? `<h6>${partido.resultado}</h6>` : ''}
                            <span>${partido.dia}</span>
                        `}
                    </div>
                    <div class="card-round-promo right">
                        <h6>${equipo2T}</h6>
                    </div>
                </div>
                <div class="bracket-round-team-right">
                    <a href="/liga-indigo/equipos/${slugEquipo2}">
                        <img src="/assets/logos/${partido.tag2}.webp" alt="${partido.equipo2}" class="img-fluid">
                    </a>
                </div>
                <div class="card-back">
                    <div class="card-color-left ${partido.tag1 === '7Z' ? 'S7Z' : partido.tag1}"></div>
                    <div class="card-color-right ${partido.tag2 === '7Z' ? 'S7Z' : partido.tag2}"></div>
                </div>
            </div>
        `}
    </div>
`;

                        });
                    } else {
                        partidosHTML += '<p>No se encontraron partidos para este equipo en las rondas definidas.</p>';
                    }

                    partidosHTML += '</div></div>';
                    document.getElementById(containerId).innerHTML = partidosHTML;
                })
                .catch(error => {
                    console.error('Error al cargar calendario.json:', error);
                    document.getElementById(containerId).innerHTML = '<p>Error al cargar la informaci√≥n de los partidos.</p>';
                });
        }

        function truncateString(str, maxLength) {
            if (str.length > maxLength) {
                return str.substring(0, maxLength) + '...';
            }
            return str;
        }

        function cargarDropdownEquipos(data) {
            const dropdownList = document.getElementById("dropdownList");
            const mapa = new Map();

            data[0].rondas.forEach(r => {
                r.partidos.forEach(p => {
                    if (p.tag1 && p.equipo1 && p.tag1 !== "DES") {
                        mapa.set(p.tag1, p.equipo1);
                    }
                    if (p.tag2 && p.equipo2 && p.tag2 !== "DES") {
                        mapa.set(p.tag2, p.equipo2);
                    }
                });
            });

            // Excluir al equipo actual
            if (mapa.has(pageID)) {
                mapa.delete(pageID);
            }

            const equiposOrdenados = [...mapa.entries()]
                .sort((a, b) => a[1].localeCompare(b[1]));

            dropdownList.innerHTML = equiposOrdenados.map(([tag, name]) => `
        <div class="dropdown-item" data-tag="${tag}" data-name="${name}">
            <img src="/assets/logos/${tag}.webp" alt="${name}">
            <span>${name}</span>
        </div>
    `).join('');
        }

        // ===== RENDERIZAR COMPARACI√ìN =====
        function renderCalendarComparison(equipoA, rivalTag, rivalName, containerId, roundsDatesFromScript) {
            const teamTagA = equipoA.tag;
            const teamNameA = equipoA.team || equipoA.tag;

            if (!teamTagA || !rivalTag || teamTagA === rivalTag) {
                document.getElementById(containerId).innerHTML = '<p>Selecciona un rival v√°lido.</p>';
                return;
            }

            const roundDatesMap = new Map();
            roundsDatesFromScript.forEach(r => {
                const fechaStr = r.fecha || (r.fecha_inicio && r.fecha_fin ? `${r.fecha_inicio} - ${r.fecha_fin}` : 'Fecha no definida');
                roundDatesMap.set(r.ronda, fechaStr);
            });

            fetch('/assets/temporadas/actual/calendario.json')
                .then(r => r.json())
                .then(data => {
                    if (!data?.[0]?.rondas) throw new Error('calendario.json inv√°lido');

                    const tagToName = new Map();
                    const partidosA = [];
                    const partidosB = [];

                    data[0].rondas.forEach(ronda => {
                        ronda.partidos.forEach(p => {
                            if (p.tag1 && p.equipo1) tagToName.set(p.tag1, p.equipo1);
                            if (p.tag2 && p.equipo2 && p.tag2 !== "DES") tagToName.set(p.tag2, p.equipo2);

                            if (p.tag1 === teamTagA || p.tag2 === teamTagA) {
                                const partidoConRonda = { ...p, rondaNombre: ronda.ronda };
                                const partidoA = aplicarInversionPorEquipo(partidoConRonda, teamTagA);
                                const rivalTagA = partidoA.tag1 === teamTagA ? partidoA.tag2 : partidoA.tag1;
                                const rivalNameA = partidoA.tag1 === teamTagA ? partidoA.equipo2 : partidoA.equipo1;
                                partidosA.push({ ...partidoA, rondaNombre: ronda.ronda, rivalTag: rivalTagA, rivalName: rivalNameA });
                            }

                            // Para equipo B (rival)
                            if (p.tag1 === rivalTag || p.tag2 === rivalTag) {
                                const partidoConRonda = { ...p, rondaNombre: ronda.ronda };
                                const partidoB = aplicarInversionPorEquipo(partidoConRonda, teamTagA);
                                const rivalTagB = partidoB.tag1 === rivalTag ? partidoB.tag2 : partidoB.tag1;
                                const rivalNameB = partidoB.tag1 === rivalTag ? partidoB.equipo2 : partidoB.equipo1;
                                partidosB.push({ ...partidoB, rondaNombre: ronda.ronda, rivalTag: rivalTagB, rivalName: rivalNameB });
                            }
                        });
                    });

                    tagToName.set(rivalTag, rivalName);

                    const rivalesTags = new Set([
                        ...partidosA.map(p => p.rivalTag),
                        ...partidosB.map(p => p.rivalTag)
                    ]);

                    const rivalesOrdenados = Array.from(rivalesTags)
                        .map(tag => ({ tag, name: tagToName.get(tag) || tag }))
                        .filter(r => r.name && r.name !== "DES")
                        .sort((a, b) => a.name.localeCompare(b.name, 'es', { sensitivity: 'base' }));

                    const mapaA = new Map(partidosA.map(p => [p.rivalTag, p]));
                    const mapaB = new Map(partidosB.map(p => [p.rivalTag, p]));

                    let html = `
                    <div class="comparacion-calendarios">
                        <h2>Comparaci√≥n: ${teamNameA} vs ${rivalName}</h2>
                        <div class="row comparacion-grid">
                `;

                    rivalesOrdenados.forEach(rival => {
                        const pA = mapaA.get(rival.tag);
                        const pB = mapaB.get(rival.tag);

                        // Funci√≥n interna para generar una card estilo renderMatchInfo
                        const buildCard = (partido, equipoLocalTag, nombreRival, tagRival) => {
                            if (!partido) {
                                return `
                <div class="col-12 col-md-6 col-lg-6 col-xl-4">
                    <div class="bracket-round-list-zzz">
                        <div class="card-round-promo"><h3>‚Äî</h3></div>
                        <div class="card-back">
                            <div class="card-color-left bg-light"></div>
                            <div class="card-color-right bg-light"></div>
                        </div>
                    </div>
                </div>`;
                            }

                            const fecha = formatDateToDayMonth(roundDatesMap.get(partido.rondaNombre) || 'Fecha no definida');
                            const resultado = partido.resultado || 'VS';

                            const nombreLocal = partido.equipo1;
                            const tagLocal = partido.tag1;
                            const nombreRivalReal = partido.equipo2;
                            const tagRivalReal = partido.tag2;

                            const localT = truncateString(nombreLocal, 12);
                            const rivalT = truncateString(nombreRival, 12);

                            const slugLocal = equipoSlugs[nombreLocal] || nombreLocal.toLowerCase().replace(/\s+/g, '-');
                            const slugRival = equipoSlugs[nombreRival] || nombreRival.toLowerCase().replace(/\s+/g, '-');

                            return `
            <div class="col-12 col-md-6 col-lg-6 col-xl-4">
                <div class="bracket-round-list">
                    <div class="bracket-round-team">
                        <a href="/liga-indigo/equipos/${slugLocal}">
                            <img src="/assets/logos/${tagLocal}.webp" alt="${nombreLocal}" class="img-fluid">
                        </a>
                    </div>
                    <div class="round-titles">
                        <div class="card-round-promo left"><h6>${localT}</h6></div>
                        <div class="card-round-promo mx-2">
                            <span>${partido.rondaNombre}</span>
                            ${resultado !== "VS" ? `<h6>${resultado}</h6>` : ''}
                            <span>${fecha}</span>
                        </div>
                        <div class="card-round-promo right"><h6>${rivalT}</h6></div>
                    </div>
                    <div class="bracket-round-team-right">
                        <a href="/liga-indigo/equipos/${slugRival}">
                            <img src="/assets/logos/${tagRival}.webp" alt="${nombreRival}" class="img-fluid">
                        </a>
                    </div>
                    <div class="card-back">
                        <div class="card-color-left ${tagLocal === '7Z' ? 'S7Z' : tagLocal}"></div>
                        <div class="card-color-right ${tagRival === '7Z' ? 'S7Z' : tagRival}"></div>
                    </div>
                </div>
            </div>
        `;
                        };

                        html += `<div class="row mb-4">`;
                        html += buildCard(pA, teamTagA, rival.name, rival.tag);
                        html += buildCard(pB, rivalTag, rival.name, rival.tag);
                        html += `</div>`;
                    });

                    html += '</div>';
                    document.getElementById(containerId).innerHTML = html;
                })
                .catch(err => {
                    console.error('Error comparaci√≥n:', err);
                    document.getElementById(containerId).innerHTML = '<p>Error en comparaci√≥n.</p>';
                });
        }

        document.getElementById("dropdownBtn").addEventListener("click", () => {
            document.getElementById("rivalDropdown").classList.toggle("dropdown-open");
        });

        // ‚úÖ DELEGACI√ìN DE EVENTOS: funciona siempre
        document.getElementById("dropdownList").addEventListener("click", function (e) {
            const item = e.target.closest(".dropdown-item");
            if (!item) return;

            const rivalTag = item.dataset.tag;
            const rivalName = item.dataset.name;

            console.log("üîç Rival seleccionado:", { rivalTag, rivalName });

            if (!rivalTag || !rivalName) {
                console.error("‚ö†Ô∏è ¬°Tag o nombre faltante!");
                return;
            }

            // Actualizar UI
            document.getElementById("selectedTag").value = rivalTag;
            document.getElementById("selectedName").textContent = rivalName;
            document.getElementById("selectedLogo").innerHTML =
                `<img src="/assets/logos/${rivalTag}.webp" style="height:24px;width:auto;">`;

            document.getElementById("rivalDropdown").classList.remove("dropdown-open");

            if (window.equipoActual) {
                renderCalendarComparison(
                    window.equipoActual,
                    rivalTag,
                    rivalName,
                    'comparisonContainer',
                    roundSpecificData
                );
            }
        });

     function aplicarInversionPorEquipo(partidoOriginal, equipoTag) {
    let p = { ...partidoOriginal };
    
    const esEquipo1 = p.tag1 === equipoTag;
    const esEquipo2 = p.tag2 === equipoTag;

    if (!esEquipo1 && !esEquipo2) return p;

    // ‚úÖ Defensa: si no hay rondaNombre, no invertir
    if (!p.rondaNombre) {
        console.warn("Partido sin rondaNombre:", p);
        return p;
    }

    const numeroRonda = parseInt(p.rondaNombre.replace('RONDA ', '')); // ‚úÖ ahora existe
    const esRondaPar = !isNaN(numeroRonda) && numeroRonda % 2 === 0;
    const esDescanso = p.equipo2 === "DES";

    if (esRondaPar && !esDescanso) {
        if (esEquipo1) {
            [p.equipo1, p.equipo2] = [p.equipo2, p.equipo1];
            [p.tag1, p.tag2] = [p.tag2, p.tag1];
            if (p.resultado?.includes('-')) {
                const [a, b] = p.resultado.split('-');
                p.resultado = `${b}-${a}`;
            }
        }
    } else {
        if (esEquipo2) {
            [p.equipo1, p.equipo2] = [p.equipo2, p.equipo1];
            [p.tag1, p.tag2] = [p.tag2, p.tag1];
            if (p.resultado?.includes('-')) {
                const [a, b] = p.resultado.split('-');
                p.resultado = `${b}-${a}`;
            }
        }
    }

    return p;
}

        Promise.all([
            fetch(jsonBannerURL).then(r => r.json()),
            fetch('/assets/temporadas/actual/calendario.json').then(r => r.json())
        ])
            .then(([equipo, calendarioData]) => {
                window.equipoActual = equipo;

                renderBanner(equipo, 'equipo-perfil');
                renderMatchInfo(equipo, 'equipo-perfil-partidos', roundSpecificData);
                cargarDropdownEquipos(calendarioData);
            })
            .catch(err => {
                console.error("Error carga inicial:", err);
                document.getElementById('equipo-perfil').innerHTML = '<p>Error al cargar datos.</p>';
            });

        // Cargar roster por separado
        fetch(jsonRosterURL)
            .then(r => r.json())
            .then(roster => renderRoster(roster, 'equipo-perfil-roster'))
            .catch(err => {
                console.warn("Roster no disponible");
                document.getElementById('equipo-perfil-roster').innerHTML = '<p>Roster no disponible.</p>';
            });



    });
</script>