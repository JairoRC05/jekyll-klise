---
layout: null
title: Admin - Monedas
permalink: /admin-user
---

<style>
    .admin-container {
        max-width: 600px;
        margin: 30px auto;
        padding: 20px;
    }

    input,
    button,
    select {
        padding: 8px;
        margin: 5px 0;
        width: 100%;
        box-sizing: border-box;
    }

    .log {
        background: #f5f5f5;
        padding: 10px;
        margin-top: 15px;
        border-radius: 4px;
    }
</style>

<div class="admin-container">
    <h2>Dashboard de Monedas</h2>

    <div>
        <input type="text" id="busqueda" placeholder="Nickname o ID de juego">
        <button onclick="buscarJugador()">Buscar jugador</button>
    </div>

    <div id="resultado" style="display:none; margin-top:20px; padding:15px; border:1px solid #ccc; border-radius:6px;">
  <p><strong>Jugador:</strong> <span id="nombre"></span></p>
  <p><strong>Monedas actuales:</strong> <span id="saldo"></span></p>
  <p><strong>Plan actual:</strong> <span id="plan-actual" style="font-weight:bold;"></span></p>

  <!-- Sección para actualizar monedas -->
  <div style="margin-top:15px; padding-top:10px; border-top:1px dashed #ccc;">
    <h4>Actualizar monedas</h4>
    <input type="number" id="cantidad" placeholder="Cantidad (ej: +50 o -20)" min="-1000" max="1000">
    <input type="text" id="motivo" placeholder="Motivo (ej: Liga Abril)">
    <button onclick="otorgarMonedas()">Aplicar cambios</button>
  </div>

  <!-- Sección para cambiar plan -->
  <div style="margin-top:15px; padding-top:10px; border-top:1px dashed #ccc;">
    <h4>Cambiar plan/status</h4>
    <select id="nuevo-plan">
      <option value="free">Free</option>
      <option value="premium">Premium</option>
      <option value="streamer">Streamer</option>
      <option value="coach">Coach</option>
    </select>
    <button onclick="cambiarPlan()">Actualizar plan</button>
  </div>
</div>

    <div id="mensaje"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<script>
    const firebaseConfig = {
   apiKey: "AIzaSyBXznASeaw8vtU6OWwiP2kkVBh0L0b45y4",
        authDomain: "unite-mex.firebaseapp.com",
        projectId: "unite-mex",
 appId: "1:248961873504:web:b9ad5434d6a1041bc73505"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);

    const db = firebase.firestore();
    const auth = firebase.auth();

    let jugadorSeleccionado = null;

    // Verificar que eres admin
    auth.onAuthStateChanged(user => {
        if (!user || user.uid !== '3PLlmGJbrucsk87qhBG7xNpD3rJ2') {
            alert("Acceso denegado. Solo para administradores.");
            window.location.href = '/iniciar-sesion';
        }
    });

    async function buscarJugador() {
        const query = document.getElementById('busqueda').value.trim();
        if (!query) return;

        try {
            // Buscar por nickname o id_juego
            const snapshot = await db.collection('usuarios')
                .where('nickname', '==', query)
                .limit(1)
                .get();

            let doc;
            if (snapshot.empty) {
                const snapshot2 = await db.collection('usuarios')
                    .where('id_juego', '==', query)
                    .limit(1)
                    .get();
                doc = !snapshot2.empty ? snapshot2.docs[0] : null;
            } else {
                doc = snapshot.docs[0];
            }

            if (doc) {
                const data = doc.data();
                jugadorSeleccionado = { id: doc.id, ...data };
                document.getElementById('nombre').textContent = data.nickname;
                document.getElementById('saldo').textContent = data.monedas || 0;
                document.getElementById('plan-actual').textContent = data.plan || 'free';
                document.getElementById('resultado').style.display = 'block';
                document.getElementById('mensaje').textContent = '';
            } else {
                document.getElementById('mensaje').textContent = 'Jugador no encontrado.';
                document.getElementById('resultado').style.display = 'none';
            }
        } catch (err) {
            console.error(err);
            document.getElementById('mensaje').textContent = 'Error al buscar: ' + err.message;
        }
    }

    async function otorgarMonedas() {
        if (!jugadorSeleccionado) return;

        const cantidad = parseInt(document.getElementById('cantidad').value);
        const motivo = document.getElementById('motivo').value.trim();

        if (isNaN(cantidad)) {
            alert("Ingresa una cantidad válida.");
            return;
        }
        if (!motivo) {
            alert("Ingresa un motivo.");
            return;
        }

        try {
            const nuevoSaldo = (jugadorSeleccionado.monedas || 0) + cantidad;
            await db.collection('usuarios').doc(jugadorSeleccionado.id).update({
                monedas: nuevoSaldo
            });

            // Opcional: guardar historial en subcolección
            await db.collection('usuarios').doc(jugadorSeleccionado.id).collection('historial_monedas').add({
                cantidad: cantidad,
                motivo: motivo,
                admin: 'TU_NOMBRE',
                fecha: firebase.firestore.FieldValue.serverTimestamp()
            });

            document.getElementById('saldo').textContent = nuevoSaldo;
            document.getElementById('mensaje').innerHTML = `<strong>¡Monedas actualizadas!</strong> ${cantidad > 0 ? '+' : ''}${cantidad}`;
            document.getElementById('cantidad').value = '';
            document.getElementById('motivo').value = '';
        } catch (err) {
            console.error(err);
            document.getElementById('mensaje').textContent = 'Error: ' + err.message;
        }
    }

    async function cambiarPlan() {
  if (!jugadorSeleccionado) return;

  const nuevoPlan = document.getElementById('nuevo-plan').value;
  const planesPermitidos = ['free', 'premium', 'streamer', 'coach'];
  
  if (!planesPermitidos.includes(nuevoPlan)) {
    alert("Plan no válido.");
    return;
  }

  try {
    await db.collection('usuarios').doc(jugadorSeleccionado.id).update({
      plan: nuevoPlan
    });
    document.getElementById('plan-actual').textContent = nuevoPlan;
    document.getElementById('mensaje').innerHTML = `<strong>¡Plan actualizado a ${nuevoPlan}!</strong>`;
  } catch (err) {
    console.error(err);
    document.getElementById('mensaje').textContent = 'Error al cambiar plan: ' + err.message;
  }
}

</script>