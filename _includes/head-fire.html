<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<script>


  // Inicializar Firebase (solo una vez en todo el sitio)
  if (!firebase.apps.length) {
    const firebaseConfig = {
   apiKey: "AIzaSyBXznASeaw8vtU6OWwiP2kkVBh0L0b45y4",
        authDomain: "unite-mex.firebaseapp.com",
        projectId: "unite-mex",
 appId: "1:248961873504:web:b9ad5434d6a1041bc73505"
    };
    firebase.initializeApp(firebaseConfig);
  }

  const auth = firebase.auth();
  const db = firebase.firestore();

  // Escuchar estado de autenticación en toda la app
  auth.onAuthStateChanged(async (user) => {
    const userInfoEl = document.getElementById('user-info');
    const guestLinksEl = document.getElementById('guest-links');

    if (user) {
      // Usuario autenticado → mostrar su info
      guestLinksEl.style.display = 'none';
      userInfoEl.style.display = 'flex';

      try {
        const doc = await db.collection('usuarios').doc(user.uid).get();
        if (doc.exists) {
          const data = doc.data();
          const avatar = data.avatar || 'female1';
          const nickname = data.nickname || 'Jugador';
          // const idJuego = data.id_juego || user.uid.substring(0,8);

          document.getElementById('nav-avatar').src = `/assets/avatars/${avatar}.webp`;
          document.getElementById('nav-nickname').textContent = nickname;
          // document.getElementById('nav-id').textContent = idJuego;
        }
      } catch (err) {
        console.warn("No se pudo cargar el perfil:", err);
      }
    } else {
      // Usuario no autenticado
      userInfoEl.style.display = 'none';
      guestLinksEl.style.display = 'block';
    }
  });
</script>