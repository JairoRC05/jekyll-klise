---
layout: login
title: Perfil del Jugador - Unite Mex
permalink: /jugador.html
---

<style>
  /* --- HEADER --- */
  .perfil-header {
    text-align: center;
    padding: 2rem 1rem;
    background: linear-gradient(135deg, #0d6efd, #6610f2);
    color: white;
    border-radius: 18px;
    margin-bottom: 2rem;
  }

  .avatar-xl {
    width: 120px;
    height: 120px;
    border: 4px solid #fff;
    object-fit: cover;
    border-radius: 50%;
    margin-bottom: 1rem;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
  }

  .plan-badge {
    font-size: 0.75rem;
    padding: 6px 14px;
    border-radius: 50px;
  }

  /* --- SECCIONES --- */

  .seccion {
    background: #ffffff;
    border-radius: 16px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    border: 1px solid #e9ecef;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.04);
  }

  .seccion h3 {
    font-weight: 600;
    font-size: 1.2rem;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  /* --- GRID CARDS --- */

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
    gap: 1rem;
  }

  .item {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 0.8rem;
    text-align: center;
    border: 1px solid #e5e5e5;
    transition: 0.2s;
  }

  .item:hover {
    background: #eef3ff;
    transform: translateY(-2px);
  }

  /* --- LOGROS Y TRAYECTORIA --- */

  .logro-item,
  .trayectoria-item {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 12px 0;
    border-bottom: 1px solid #f1f1f1;
  }

  .logro-item:last-child,
  .trayectoria-item:last-child {
    border-bottom: none;
  }

  .logro-item img,
  .trayectoria-item img {
    width: 44px;
    height: 44px;
    border-radius: 8px;
    object-fit: cover;
  }

  /* --- ICONOS SECCIONES --- */
  h3::before {
    color: #0d6efd;
  }
</style>


<div class="container py-4">

  <!-- Loading -->
  <div id="loading" class="text-center">
    <div class="spinner-border text-primary"></div>
    <p class="mt-2 text-muted">Cargando perfil...</p>
  </div>

  <!-- Contenido -->
  <div id="perfil" style="display:none;">

    <!-- HEADER -->
    <div class="perfil-header">
      <img id="avatar" class="avatar-xl" src="/assets/avatars/female1.webp" alt="Avatar">
      <h1 id="nickname" class="fw-bold mb-0">Jugador</h1>
      <div class="mt-2">
        <span id="plan-badge" class="plan-badge bg-secondary text-white">Free</span>
        <div id="rol-equipo" class="mt-1 small opacity-75">‚Äî</div>
      </div>
    </div>

    <!-- CONTACTO -->
    <div class="seccion">
      <h3>üí¨ Contacto</h3>
      <p><strong>ID de juego:</strong> <span id="id-juego">‚Äî</span></p>
      <p><strong>Discord:</strong> <span id="discord">‚Äî</span></p>
      <p id="descripcion" class="mt-2 text-muted">‚Äî</p>
    </div>

    <div class="seccion">
      <h3>üèÖ Insignias</h3>
      <div id="insignias-lista"></div>
    </div>

    <!-- ESTADISTICAS -->
    <div class="seccion">
      <h3>üìä Estad√≠sticas</h3>

      <div class="grid">
        <div class="item">
          <div class="text-muted small">Partidas</div>
          <strong id="partidas">‚Äî</strong>
        </div>
        <div class="item">
          <div class="text-muted small">Main</div>
          <strong id="main">‚Äî</strong>
        </div>
        <div class="item">
          <div class="text-muted small">Rol</div>
          <strong id="rol">‚Äî</strong>
        </div>
      </div>

      <h4 class="mt-4 mb-2 fs-5 fw-semibold">Picks</h4>
      <div id="picks" class="grid"></div>
    </div>

    <!-- TRAYECTORIA -->
    <div id="seccion-trayectoria" class="seccion" style="display:none;">
      <h3>üèÖ Trayectoria</h3>
      <div id="trayectoria-lista"></div>
    </div>

    <!-- LOGROS -->
    <div id="seccion-logros" class="seccion" style="display:none;">
      <h3>üèÜ Logros</h3>
      <div id="logros-lista"></div>
    </div>

    <!-- REDES -->
    <div id="seccion-redes" class="seccion" style="display:none;">
      <h3>üì± Redes sociales</h3>
      <div id="redes-lista"></div>
    </div>

    <!-- STREAMER -->
    <div id="seccion-streamer" class="seccion" style="display:none;">
      <h3>üé• Streamer</h3>
      <div id="streamer-datos"></div>
    </div>

    <div class="seccion">
      <h3>üîÑ Historial de nicknames</h3>
      <p id="historial-nicks" class="text-muted">Sin cambios.</p>
    </div>



  </div>

  <div id="error" class="alert alert-danger mt-3" style="display:none;"></div>
</div>



<script>
  // ---------- Verifica que Firestore est√© inicializado ----------
  if (typeof db === 'undefined') {
    // Si usas firebase v8:
    if (window.firebase && firebase.firestore) {
      window.db = firebase.firestore();
    } else {
      console.error('Firestore no est√° inicializado. Aseg√∫rate de importar e inicializar Firebase antes de este script.');
    }
  }

  // ---------- Extraer idJuego (√∫ltimo segmento de la ruta) ----------
  function getIdJuegoFromPath() {
    const path = window.location.pathname; // ejemplo: "/jugador/1HQ5X78" o "/jugador/1HQ5X78/"
    const parts = path.split('/').filter(Boolean); // elimina segmentos vac√≠os
    // toma el √∫ltimo segmento
    return parts.length ? parts[parts.length - 1] : null;
  }

  const idJuego = getIdJuegoFromPath();

  if (!idJuego || idJuego.length < 2) {
    document.getElementById('error').textContent = "Jugador no v√°lido.";
    document.getElementById('error').style.display = 'block';
    document.getElementById('loading').style.display = 'none';
  } else {
    cargarPerfilPorIdJuego(idJuego);
  }


  // En cargarPerfilPorIdJuego()


  // ---------- Funci√≥n principal para cargar perfil ----------
  async function cargarPerfilPorIdJuego(idJuego) {
    try {
      console.log('Buscando jugador con id_juego =', idJuego);

      const snapshot = await db.collection('jugadores_publicos')
        .where('id_juego', '==', idJuego)
        .limit(1)
        .get();

      // DEBUG: imprimir snapshot
      console.log('Snapshot size:', snapshot.size);
      snapshot.docs.forEach(d => console.log('Doc id:', d.id, 'data:', d.data()));

      if (snapshot.empty) {
        // Mensaje m√°s √∫til para debug
        console.warn('No se encontr√≥ jugador con id_juego =', idJuego);
        throw new Error("Jugador no encontrado.");
      }

      const doc = snapshot.docs[0];
      const data = doc.data();
      const uid = doc.id;

      // Mostrar el perfil
      document.getElementById('loading').style.display = 'none';
      document.getElementById('perfil').style.display = 'block';

      // HEADER
      document.getElementById('avatar').src = `/assets/avatars/${data.avatar || 'female1'}.webp`;
      document.getElementById('nickname').textContent = data.nickname || 'Jugador';
      document.getElementById('rol-equipo').textContent = `${data.rol || '‚Äî'} ‚Ä¢ ${data.equipo || '‚Äî'}`;

      // Plan badge
      const badge = document.getElementById('plan-badge');
      badge.textContent = (data.plan || 'Free').toString().charAt(0).toUpperCase() + (data.plan || 'Free').slice(1);
      badge.className = 'plan-badge';
      if (data.plan === 'premium') badge.classList.add('bg-warning', 'text-dark');
      else if (data.plan === 'streamer') badge.classList.add('bg-pink', 'text-white');
      else if (data.plan === 'coach') badge.classList.add('bg-success', 'text-white');
      else badge.classList.add('bg-secondary', 'text-white');

      // CONTACTO
      document.getElementById('id-juego').textContent = data.id_juego || '‚Äî';
      document.getElementById('discord').textContent = data.discord || '‚Äî';
      document.getElementById('descripcion').textContent = data.descripcion || 'Sin descripci√≥n.';

      // ESTAD√çSTICAS
      document.getElementById('partidas').textContent = (typeof data.partidas !== 'undefined') ? data.partidas : '‚Äî';
      document.getElementById('main').textContent = data.mains || '‚Äî';
      document.getElementById('rol').textContent = data.rol || '‚Äî';

      // PICKS
      const picksEl = document.getElementById('picks');
      picksEl.innerHTML = '';
      (data.picks || []).forEach(pick => {
        const node = document.createElement('div');
        node.className = 'item';
        node.textContent = pick;
        picksEl.appendChild(node);
      });

      // Trayectoria / Logros / Redes / Streamer
      renderTrayectoria(data.trayectoria || []);
      renderLogros(data.logros || []);
      if (data.plan && data.plan !== 'free') renderRedes(data);
      if (data.plan === 'streamer') renderStreamer(data);


      if (data.historial_nicks && data.historial_nicks.length > 0) {
        const nicks = data.historial_nicks
          .map(n => n.nickname)
          .filter((nick, i, arr) => arr.indexOf(nick) === i) // Eliminar duplicados
          .join(', ');

        document.getElementById('historial-nicks').textContent = nicks;
      }


      // Cargar insignias
      const insigniasSnap = await db.collection('usuarios').doc(uid).collection('insignias').get();
      const insignias = [];
      insigniasSnap.forEach(doc => insignias.push(doc.data()));

      // Renderizar
      const cont = document.getElementById('insignias-lista');
      if (insignias.length) {
        let html = '<div class="d-flex flex-wrap gap-3 justify-content-center">';
        insignias.forEach(b => {
          html += `
      <div class="text-center" title="${b.nombre}">
        <img src="/assets/insignias/${b.imagen}" width="50" height="50" style="object-fit: contain;">
        <div><small>${b.nombre}</small></div>
      </div>
    `;
        });
        html += '</div>';
        cont.innerHTML = html;
      } else {
        cont.innerHTML = '<p class="text-muted text-center">Sin insignias.</p>';
      }


    } catch (err) {
      console.error(err);
      document.getElementById('loading').style.display = 'none';
      document.getElementById('error').textContent = err.message || "Ocurri√≥ un error al cargar el perfil.";
      document.getElementById('error').style.display = 'block';
    }
  }

  function renderInsignias(insignias) {
    const cont = document.getElementById('insignias-lista');
    if (!insignias.length) {
      cont.innerHTML = '<p class="text-muted">Sin insignias.</p>';
      return;
    }

    let html = '<div class="d-flex flex-wrap gap-2">';
    insignias.forEach(b => {
      html += `
      <div title="${b.nombre}" style="text-align:center;">
        <img src="/assets/insignias/${b.imagen}" width="40" height="40" style="object-fit:contain;">
        <div><small>${b.nombre}</small></div>
      </div>
    `;
    });
    html += '</div>';
    cont.innerHTML = html;
  }


  function renderTrayectoria(trayectoria) {
    const cont = document.getElementById('trayectoria-lista');
    const seccion = document.getElementById('seccion-trayectoria');
    if (!trayectoria || trayectoria.length === 0) {
      seccion.style.display = 'none';
      return;
    }
    seccion.style.display = 'block';
    cont.innerHTML = '';
    trayectoria.forEach(t => {
      const wrap = document.createElement('div');
      wrap.className = 'trayectoria-item';
      wrap.innerHTML = `
        <img src="${t.equipoLogo || '/assets/placeholder-team.webp'}" alt="Equipo">
        <div>
          <div><strong>${t.equipoNombre || '‚Äî'}</strong></div>
          <div class="text-muted small">${t.rol || '‚Äî'} ‚Ä¢ ${t.tiempo || '‚Äî'}</div>
        </div>
      `;
      cont.appendChild(wrap);
    });
  }

  function renderLogros(logros) {
    const cont = document.getElementById('logros-lista');
    const seccion = document.getElementById('seccion-logros');
    if (!logros || logros.length === 0) {
      seccion.style.display = 'none';
      return;
    }
    seccion.style.display = 'block';
    cont.innerHTML = '';
    logros.forEach(l => {
      const wrap = document.createElement('div');
      wrap.className = 'logro-item';
      wrap.innerHTML = `
        <img src="${l.equipoLogo || '/assets/placeholder-team.webp'}" alt="Equipo">
        <div>
          <div><strong>${l.posicion || '‚Äî'}</strong></div>
          <div class="text-muted small">${l.torneoNombre || '‚Äî'} ‚Ä¢ ${l.fecha || '‚Äî'}</div>
        </div>
        <img src="${l.torneoLogo || '/assets/placeholder-tournament.webp'}" alt="Torneo" style="width:40px;height:40px;border-radius:6px;object-fit:cover;margin-left:auto;">
      `;
      cont.appendChild(wrap);
    });
  }

  function renderRedes(data) {
    const redes = [];
    if (data.instagram) redes.push({ name: 'Instagram', value: data.instagram, icon: 'üì∏' });
    if (data.x) redes.push({ name: 'X', value: data.x, icon: 'üê¶' });
    if (data.facebook) redes.push({ name: 'Facebook', value: data.facebook, icon: 'üìò' });

    if (redes.length) {
      const cont = document.getElementById('redes-lista');
      const seccion = document.getElementById('seccion-redes');
      seccion.style.display = 'block';
      cont.innerHTML = redes.map(r =>
        `<p class="mb-1"><strong>${r.icon} ${r.name}:</strong> ${r.value}</p>`
      ).join('');
    }
  }

  function renderStreamer(data) {
    const items = [];
    if (data.horario) items.push(`<strong>Horario:</strong> ${data.horario}`);
    if (data.seguidores) items.push(`<strong>Seguidores:</strong> ${data.seguidores}`);
    if (data.twitch) items.push(`<strong>Twitch:</strong> <a href="https://${data.twitch}" target="_blank">${data.twitch}</a>`);
    if (data.youtube) items.push(`<strong>YouTube:</strong> <a href="https://${data.youtube}" target="_blank">${data.youtube}</a>`);
    if (data.kick) items.push(`<strong>Kick:</strong> <a href="https://${data.kick}" target="_blank">${data.kick}</a>`);
    if (data.categorias) items.push(`<strong>Categor√≠as:</strong> ${data.categorias}`);

    if (items.length) {
      const cont = document.getElementById('streamer-datos');
      const seccion = document.getElementById('seccion-streamer');
      seccion.style.display = 'block';
      cont.innerHTML = items.join('<br>');
    }
  }
</script>